<!DOCTYPE html>
<title>API - Traveller Map</title>
<meta charset="utf-8">
<link rel="shortcut icon" href="../favicon.ico">
<link rel="stylesheet" href="../site.css?update=2017-08-16T15:42:20">
<meta name="viewport" content="initial-scale=1, width=device-width">
<script src="https://cdn.rawgit.com/inexorabletash/poly2/v2.0.1/polyfill.min.js"></script>

<style>
h3 { text-decoration: underline; }

#features th { width: 10pt; }
#features th:first-of-type { width: auto; }
#features th,
#features td { text-align: center; padding-left: 4pt; padding-right: 4pt; }
table#features, #features th, #features td { border: solid 1px black; }

#sample_markers { margin-left: 1in; }
#sample_markers td { padding-right: 0.25in; }

@media only screen and (max-width: 6.5in)  {
  #sample_markers { margin-left: 0; }
  #sample_markers td { padding-right: 0; }
}
</style>

<h1 class=sitename>API</h1>
<div class="content">

    <p>
        The Traveller Map site works by having a browser-based client
        application written
        in <a href="http://javascript.crockford.com/javascript.html">JavaScript</a>
        call various APIs provided by the web site to render map
        tiles, provide search results, look up coordinates, and so
        forth. The browser provides the HTML+CSS rendering, layout and
        interaction engine, the web site provides the content, and the
        script glues it together.
    </p>
    <p>
        All of these APIs may be called by other applications. In
        addition, several other APIs have been exposed specifically
        for external applications or users to take advantage of.
    </p>
    <p>
      If you start developing against these APIs in any form, please
      let me know! Email me
      at <a href="mailto:inexorabletash@gmail.com">inexorabletash@gmail.com</a>.
      In addition,
      the <a href="https://travellermap.blogspot.com/">blog</a> is a
      good source of news and discussion around the site and APIs.
    </p>
    <p class="aside">
      Many APIs take <code>x</code> and <code>y</code> coordinate
      parameters. The coordinate system for those values varies
      depending on the API. See the <a href="#systems">Coordinate
      Systems</a> documentation for more details.
    </p>



  <section>
    <h2>Common Concepts</h2>

  <section id="urls">
    <h3>Functional APIs vs. Semantic Data URLs</h3>
    <p>
      The site exposes the same functions through two different URL
      schemes. For example, to render a poster-style map of Deneb you
      can use either of these URLs:
    </p>
    <p class="code">https://travellermap.com/api/poster?sector=Deneb</p>
    <p class="code">https://travellermap.com/data/Deneb/image</p>
    <p>
      The first URL is structured based on the function that is being
      performed, and takes parameters (defining data to operate on)
      and options (that refine the behavior); these URLs start with
      a <code>/api/</code> prefix.

      The second URL is structured around the object being operated
      on, then specifies the data to retrieve; these URLs start with
      a <code>/data/</code> prefix.
    </p>

    <p>
      In this case, both URLs expose identical functionality. Not all
      functions exposed by the first ("api") form have a corresponding
      second ("data") form &ndash; for example, rendering arbitrary
      rectangles of space, or selecting a sector by x/y coordinates.
      On the other hand, the data URLs are much easier to remember and
      share. Both will be supported indefinitely.
    </p>
    <h3>Semantic URL Namespace</h3>

    <ul>
      <li>Universe
        <ul>
          <li><a href="#universe">https://travellermap.com/data</a> &ndash; list of all sectors
        </ul>
      </li>
      <li>Sector
        <ul>
          <li><a href="#sec">https://travellermap.com/data/<var>sector</var></a> &ndash; T5 Second Survey format
          <li><a href="#sec">https://travellermap.com/data/<var>sector</var>/tab</a> &ndash; T5 Tab Delimited format
          <li><a href="#sec">https://travellermap.com/data/<var>sector</var>/sec</a> &ndash; legacy SEC format
          <li><a href="#metadata">https://travellermap.com/data/<var>sector</var>/metadata</a> &ndash; XML metadata
          <li><a href="#msec">https://travellermap.com/data/<var>sector</var>/msec</a> &ndash; MSEC metadata
          <li><a href="#poster">https://travellermap.com/data/<var>sector</var>/image</a> &ndash; map
          <li><a href="#coordinates">https://travellermap.com/data/<var>sector</var>/coordinates</a> &ndash; coordinates
          <li><a href="#credits">https://travellermap.com/data/<var>sector</var>/credits</a> &ndash; credits
          <li>https://travellermap.com/data/<var>sector</var>/booklet &ndash; alias for <a target=_blank rel=noopener href="../make/booklet">booklet</a>
          <li><var>sector</var> is name e.g. <code>Spinward Marches</code> or T5SS abbreviation e.g. <code>spin</code>

        </ul>
      </li>
      <li>Quadrant
        <ul>
          <li><a href="#poster">https://travellermap.com/data/<var>sector</var>/<var>quadrant</var></a> &ndash; T5 Second Survey format
          <li><a href="#poster">https://travellermap.com/data/<var>sector</var>/<var>quadrant</var>/tab</a> &ndash; T5 Tab Delimited format
          <li><a href="#poster">https://travellermap.com/data/<var>sector</var>/<var>quadrant</var>/sec</a> &ndash; legacy SEC format
          <li><a href="#poster">https://travellermap.com/data/<var>sector</var>/<var>quadrant</var>/image</a> &ndash; map
          <li><var>sector</var> is name e.g. <code>Spinward Marches</code> or T5SS abbreviation e.g. <code>spin</code>
          <li><var>quadrant</var> is one of: <code>Alpha</code>, <code>Beta</code>, <code>Gamma</code> or <code>Delta</code>
        </ul>
      </li>
      <li>Subsector
        <ul>
          <li><a href="#poster">https://travellermap.com/data/<var>sector</var>/<var>subsector</var></a> &ndash; T5 Second Survey format
          <li><a href="#poster">https://travellermap.com/data/<var>sector</var>/<var>subsector</var>/tab</a> &ndash; T5 Tab Delimited format
          <li><a href="#poster">https://travellermap.com/data/<var>sector</var>/<var>subsector</var>/sec</a> &ndash; legacy SEC format
          <li><a href="#poster">https://travellermap.com/data/<var>sector</var>/<var>subsector</var>/image</a> &ndash; map
          <li><var>sector</var> is name e.g. <code>Spinward Marches</code> or T5SS abbreviation e.g. <code>spin</code>
          <li><var>subsector</var> is index <code>A</code> &ndash; <code>P</code> or name e.g. <code>Regina</code>
        </ul>
      </li>
      <li>World
        <ul>
          <li><a href="#jumpworlds">https://travellermap.com/data/<var>sector</var>/<var>hex</var></a> &ndash; world data
          <li><a href="#coordinates">https://travellermap.com/data/<var>sector</var>/<var>hex</var>/coordinates</a> &ndash; coordinates
          <li><a href="#credits">https://travellermap.com/data/<var>sector</var>/<var>hex</var>/credits</a> &ndash; credits

          <li><a href="#jumpworlds">https://travellermap.com/data/<var>sector</var>/<var>hex</var>/jump/<var>jump</var></a> &ndash; worlds in jump range
          <li><a href="#jumpmap">https://travellermap.com/data/<var>sector</var>/<var>hex</var>/jump/<var>jump</var>/image</a> &ndash; jump map
          <li>https://travellermap.com/data/<var>sector</var>/<var>hex</var>/sheet &ndash; alias for <a target=_blank rel=noopener href="../print/world">world</a>
          <li><var>sector</var> is name e.g. <code>Spinward Marches</code> or T5SS abbreviation e.g. <code>spin</code>
          <li><var>hex</var> is <code>XXYY</code> e.g. <code>1910</code>
          <li><var>jump</var> is a number in the range <code>0</code> &mdash; <code>12</code>
        </ul>
      </li>
    </ul>
    </section>

  <section id="options">
    <h3>Rendering Options and Styles</h3>
    <p>
        All of the APIs that produce images (<a href="#poster">Poster</a>, <a href="#jumpmap">Jump Map</a>,
        <a href="#tile">Tile</a>) as well as the site itself (including <a href="#iframe">IFRAME</a>) take
        an <code>options</code> parameter that is a bit field of rendering style options and a <code>style</code>
        parameter that names a visual style/color scheme for the map.
    </p>

    <h4>Options</h4>
    <p>
        The options are canonically defined in
        the <a href="#script">script</a> as flags that can be combined
        by adding the values together. The <code>options</code>
        parameter must be specified in decimal.
    </p>
    <p class="aside">
      Tip: You can use the checkboxes in the table below to compute an
      options value. Reload the page to see the default options.
    </p>

    <table id="options_table">
        <tr><th><th style="text-align:left;">Option<th>Hexadecimal<th>Decimal<th style="text-align: left;">Notes
        <tr><td><input type="checkbox" value="1" checked><td>SectorGrid             <td class="number">0x0001<td class="number">     1
          <td>Show sector grid.
        <tr><td><input type="checkbox" value="2" checked><td>SubsectorGrid          <td class="number">0x0002<td class="number">     2
          <td>Show subsector grid.
        <tr><td><input type="checkbox" value="4" checked><td>SectorsSelected        <td class="number">0x0004<td class="number">     4
          <td>At low scales, show only some sector names
        <tr><td><input type="checkbox" value="8"><td>SectorsAll             <td class="number">0x0008<td class="number">     8
          <td>Show all sector names
        <tr><td><input type="checkbox" value="16" checked><td>BordersMajor          <td class="number">0x0010<td class="number">    16
          <td>Show major region borders.
        <tr><td><input type="checkbox" value="32" checked><td>BordersMinor          <td class="number">0x0020<td class="number">    32
          <td>Show minor region borders.
        <tr><td><input type="checkbox" value="64" checked><td>NamesMajor            <td class="number">0x0040<td class="number">    64
          <td>Show major region names.
        <tr><td><input type="checkbox" value="128" checked><td>NamesMinor           <td class="number">0x0080<td class="number">   128
          <td>Show minor region names.
        <tr><td><input type="checkbox" value="256" checked><td>WorldsCapitals       <td class="number">0x0100<td class="number">   256
          <td>Show important worlds (capitals).
        <tr><td><input type="checkbox" value="512" checked><td>WorldsHomeworlds     <td class="number">0x0200<td class="number">   512
          <td>Show important worlds (homeworlds).
<!--
        <tr><td><td>RoutesSelected <td class="number">0x0400<td class="number">  1024
          <td>No longer used
        <tr><td><td>PrintStyle     <td class="number">0x0800<td class="number">  2048
          <td>No longer used
        <tr><td><td>CandyStyle     <td class="number">0x1000<td class="number">  4096
          <td>No longer used
-->
        <tr><td><input type="checkbox" value="8192" checked><td>ForceHexes          <td class="number">0x2000<td class="number">  8192
          <td>Never render square hexes.
        <tr><td><input type="checkbox" value="16384"><td>WorldColors        <td class="number">0x4000<td class="number"> 16384
          <td>Use additional world colors for Atm/Hyd.
        <tr><td><input type="checkbox" value="32768"><td>FilledBorders      <td class="number">0x8000<td class="number"> 32768
          <td>Background colors for bordered regions.
    </table>
    <p>
      Computed options value: <code>options=<span id="computed_options"></span></code> (<a target=_blank rel=noopener id="test_options" href="#">try it</a>)
    </p>
    <p class="aside">
      Some flag values (not listed in the above table) have been
      deprecated. See the source code for more details. Because URLs
      may exist that reference them the flags cannot be reused. Going
      forward, distinct query parameters will be used to control
      rendering options. In addition, the flags do not correspond 1:1
      to options shown on the main map page as the as the UI has
      evolved and simplified over time. Specifically, the pairs
      SectorGrid/&#x200B;SubsectorGrid, BordersMajor/&#x200B;BordersMinor,
      NamesMajor/&#x200B;NamesMinor, and WorldsCapitals/&#x200B;WorldsHomeworlds are
      always set/cleared together by one checkbox.
    </p>
    <script>
      (function () {
        function updateOptions() {
          var options = 0;
          var checkboxes = [].slice.call(document.querySelectorAll("#options_table input[type='checkbox']"));
          checkboxes.forEach(function (cb) {
            if (cb.checked) {
              options += Number(cb.value);
            }
          });
          document.querySelector("#computed_options").innerHTML = String(options);
          document.querySelector("#test_options").href = "/data/spin/C/image?options=" + encodeURIComponent(String(options));
        }
        var checkboxes = [].slice.call(document.querySelectorAll("#options_table input[type='checkbox']"));
        checkboxes.forEach(function (cb) {
          cb.onchange = updateOptions;
        });
        updateOptions();
      }());
    </script>

    <p>
      Behind the scenes, options values are one input to a style
      calculation; other inputs include the scale (see below). The
      options flags (e.g. SectorGrid) only apply at certain scales,
      per the following table:
    </p>

    <table id="features">
      <tr><th>Feature           <th><sup>1</sup>&frasl;<sub>32</sub> <th><sup>1</sup>&frasl;<sub>16</sub> <th><sup>1</sup>&frasl;<sub>8</sub> <th><sup>1</sup>&frasl;<sub>4</sub> <th><sup>1</sup>&frasl;<sub>2</sub> <th>1 <th>2 <th>4 <th>8 <th>16 <th>32 <th>64 <th>128</tr>
      <tr><td>Galaxy            <td>&bull;<td>&bull;<td>&bull;<td>&bull;<td>&bull;<td>&bull;<td><td><td><td><td><td><td></tr>
      <tr><td>Local Rifts       <td><td><td><td><td>&bull;<td>&bull;<td>&bull;<td>&bull;<td><td><td><td><td></tr>
      <tr><td>Random Star Field <td><td><td><td><td><td>&bull;<td>&bull;<td>&bull;<td><td><td><td><td></tr>
      <tr><td>Important Worlds  <td><td><td><td><td>&bull;<td>&bull;<td>&bull;<td>&bull;<td><td><td><td><td></tr>
      <tr><td>Worlds            <td><td><td><td><td><td><td><td>&bull;<td>&bull;<td>&bull;<td>&bull;<td>&bull;<td>&bull;</tr>
      <tr><td>Worlds (Basic)    <td><td><td><td><td><td><td><td><td><td><td>&bull;<td>&bull;<td>&bull;</tr>
      <tr><td>Worlds (Full Data)<td><td><td><td><td><td><td><td><td><td><td><td>&bull;<td>&bull;</tr>
      <tr><td>Worlds (UWP)      <td><td><td><td><td><td><td><td><td><td><td><td><td>&bull;</tr>
      <tr><td>Sector Grid       <td><td><td><td><td><td>&bull;<td>&bull;<td>&bull;<td>&bull;<td>&bull;<td>&bull;<td>&bull;<td>&bull;</tr>
      <tr><td>Subsector Grid    <td><td><td><td><td><td><td><td><td>&bull;<td>&bull;<td>&bull;<td>&bull;<td>&bull;</tr>
      <tr><td>Sector Names      <td><td><td><td><td><td>&bull;<td>&bull;<td>&bull;<td>&bull;<td>&bull;<td><td><td></tr>
      <tr><td>Subsector Names   <td><td><td><td><td><td><td><td><td><td><td>&bull;<td>&bull;<td></tr>
      <tr><td>Parsecs (Square)  <td><td><td><td><td><td><td><td><td><td>&bull;<td>&bull;<td><td></tr>
      <tr><td>Parsecs (Hex)     <td><td><td><td><td><td><td><td><td><td><td><td>&bull;<td>&bull;</tr>
      <tr><td>Labels (Macro)    <td><td><td><td><td>&bull;<td>&bull;<td>&bull;<td>&bull;<td><td><td><td><td></tr>
      <tr><td>Labels (Micro)    <td><td><td><td><td><td><td><td><td>&bull;<td>&bull;<td>&bull;<td>&bull;<td>&bull;</tr>
      <tr><td>Borders (Macro)   <td>&bull;<td>&bull;<td>&bull;<td>&bull;<td>&bull;<td>&bull;<td>&bull;<td><td><td><td><td><td></tr>
      <tr><td>Borders (Micro)   <td><td><td><td><td><td><td><td>&bull;<td>&bull;<td>&bull;<td>&bull;<td>&bull;<td>&bull;</tr>
      <tr><td>Routes (Macro)    <td><td><td><td><td>&bull;<td>&bull;<td>&bull;<td>&bull;<td><td><td><td><td></tr>
      <tr><td>Routes (Micro)    <td><td><td><td><td><td><td><td><td>&bull;<td>&bull;<td>&bull;<td>&bull;<td>&bull;</tr>
    </table>


    <h4>Styles</h4>

    <p>Style values include:</p>
    <dl class="params">
    <dt style="clear: both;"><img style="float: right; width: 48px; height: 48px; margin: 10px;" src="../res/ui/style-poster.png" alt="poster example">
      style=poster</dt>
    <dd>A color-on-black style that matches the "Spinward Marches" poster included with the
    <a href="http://travellerbibliography.org/gdw-ct/Deluxe.html" target=_blank rel=noopener>Deluxe Traveller</a>
    boxed set and the
    <a href="http://travellerbibliography.org/gdw-ct/knownspace.html" target=_blank rel=noopener>Imperium Map</a> poster.
    This is the default.</dd>

    <dt style="clear: both;"><img style="float: right; width: 48px; height: 48px; margin: 10px;" src="../res/ui/style-print.png" alt="print example">
      style=print</dt>
    <dd>A color-on-white style best suited for color printing.
    </dd>

    <dt style="clear: both;"><img style="float: right; width: 48px; height: 48px; margin: 10px;" src="../res/ui/style-atlas.png" alt="atlas example">
      style=atlas</dt>
    <dd>A grayscale black-on-white style that matches the visual style of the
    <a href="http://travellerbibliography.org/gdw-ct/Atlas.html">Atlas of the Imperium</a> and early supplements, best for black-and-white printing.
    </dd>

    <dt style="clear: both;"><img style="float: right; width: 48px; height: 48px; margin: 10px;" src="../res/ui/style-candy.png"  alt="candy example">
      style=candy</dt>
    <dd>A style designed by Wayne Peters that evokes interactive map displays from contemporary movies. Does not
    show world base or allegiance information, but does illustrate world size and hydrographics.</dd>

    <dt style="clear: both;"><img style="float: right; width: 48px; height: 48px; margin: 10px;" src="../res/ui/style-draft.png"  alt="draft example">
      style=draft</dt>
    <dd>A style reminiscent of GDW's original hand drawn draft of the Spinward Marches sector map.
      (A high resolution scan of the original is available on
      <a target=_blank rel=noopener
         title="GDW's original hand drawn draft of the Spinward Marches sector map"
         href="http://rpg.drivethrustuff.com/product/64319/The-Spinward-Marches">DriveThruRPG</a>.)</dd>

    <dt style="clear: both;"><img style="float: right; width: 48px; height: 48px; margin: 10px;" src="../res/ui/style-fasa.png"  alt="FASA example">
      style=fasa</dt>
    <dd>A style reminiscent of FASA's classic supplements and magazines.</dd>

    <dt style="clear: both;"><img style="float: right; width: 48px; height: 48px; margin: 10px;" src="../res/ui/style-terminal.png"  alt="Terminal example">
      style=terminal</dt>
    <dd>A style reminiscent of retro-futuristic computer terminals.</dd>
    </dl>

    <h4>Page and API</h4>

    <p>These options are available when calling rendering APIs, the main page, and
    <a href="#iframe">IFRAME</a> API.</p>

    <dl class="params">
      <dt>dimunofficial=1</dt>
      <dd>At scales where worlds are shown (dotmap or more), sectors with unofficial
        data will be dimmed</dd>

      <dt>review=1</dt>
      <dd>At scales where worlds are shown (dotmap or more), sectors will be
        tinted based on T5SS review status: official - red; in review - orange;
        unreviewed - yellow; preserve - green; apocryphal - magenta.</dd>

      <dt>routes=0</dt>
      <dd>Routes are not rendered (macro-scale or micro-scale)</dd>

      <dt>rifts=0</dt>
      <dd>Don't shade rifts. The default is to shade rifts.</dd>

      <dt>sscoords=1</dt>
      <dd>Hexes are numbered subsector style (0101-0810) instead of sector style (0101-3240)</dd>

      <dt>allhexes=1</dt>
      <dd>All hexes are numbered. The default is just to number hexes with worlds.</dd>

      <dt>nogrid=1</dt>
      <dd>Hex grid is not rendered. The default is to show a hex grid when zoomed in.</dd>

      <dt>po=1</dt>
      <dd><b>Population overlay:</b> a yellow circle with
        area proportional to the
        <a href="./secondsurvey#pbg">population</a>
        of each world is overlayed.</dd>

      <dt>im=1</dt>
      <dd><b>Importance overlay:</b> a green circle representing
        the world's <a href="./secondsurvey#ix">Importance</a> is
        overlayed.</dd>

      <dt>dw=1</dt>
      <dd><b>Droyne World overlay:</b> worlds with Droyne
        populations are annotated with &#x2605;, and worlds with
        Chirper populations are annotated with &#x2606;.</dd>

      <dt>an=1</dt>
      <dd><b>Ancient World overlay:</b> worlds with
        known Ancient sites are annotated with &#x2600;.</dd>

      <dt>mh=1</dt>
      <dd><b>Minor Race Homeworld overlay:</b> homeworlds
        of minor races are annotated with &#x273B;.</dd>

      <dt>stellar=1</dt>
      <dd>A representation of the system's stars is shown
        instead of rendering world details. Sizes are not to scale.</dd>

      <dt>hw=<var>S</var><var>N</var></dt>
      <dt>hw=<var>S</var><var>N</var>+</dt>
      <dt>hw=<var>S</var><var>N</var>-</dt>
      <dt>hw=<var>S</var><var>M</var>-<var>M</var></dt>
      <dd><b>Highlight Worlds overlay:</b>
        Worlds with a matching characteristic are highlighted. The argument
        starts with a field name, one of
        <code>St</code>
        <code>S</code>
        <code>A</code>
        <code>H</code>
        <code>P</code>
        <code>G</code>
        <code>L</code>
        <code>T</code>
        <code>Ix</code>.
        This is followed by either
        a value (field is <var>N</var>),
        a value and - (field is <var>N</var> or lower),
        a value and + (field is <var>N</var> or higher),
        or a value and - and another value (field in the range <var>N</var> to <var>M</var>).
        Note that values are decimal integers (possibly negative), not eHex.
        (<a target=_blank rel=noopener href="../?hw=Ix4+">example</a>)
      </dd>

    </dl>

    <h4>API Only</h4>

    <p>These options are available when calling rendering APIs, but not the main page or
    <a href="#iframe">IFRAME</a> API.</p>

    <dl class="params">
      <dt>dpr=<var>number</var></dt>
      <dd>The image is rendered for the specified
        <a target=_blank rel=noopener href="http://www.quirksmode.org/blog/archives/2012/07/more_about_devi.html">device pixel ratio</a>.
        For example, specifying <code>dpr=2</code> would produce an image at double the
        resolution, providing better quality for iOS "retina" and other high-density
        displays.

      <dt>datauri=1</dt>
      <dd>The image is returned as a base64-encoded
        <a target=_blank rel=noopener href="http://en.wikipedia.org/wiki/Data_URI_scheme">Data URI</a>
        rather than as binary data. This is useful when requesting images via POST via XHR
        to insert into HTML.</dd>
    </dl>

    <h4>IFRAME Only</h4>

    <p>These options are available only when the <a href="#iframe">IFRAME</a> API is used.</p>

    <dl class="params">
      <dt>forceui=1</dt>
      <dd>The page UI (search box, options buttons, etc) is shown. The default is to hide
      the UI when the map is embedded in another page. Note that not all options may make
      sense.</dd>
    </dl>
  </section>
  </section>

  <section id="html-apis" class="apis">
    <h2>HTML APIs</h2>

  <section id="query">
    <h3>Query Parameters &ndash; Main Page</h3>
    <h4>Options:</h4>
    <dl class="params">
      <dt>scale <dd>scale in pixels/parsec (default is 64)
      <dt>options <dd><a href="#options">rendering options</a>
      <dt>style <dd><a href="#options">rendering style</a>
      <dt>sector
      <dt>hex <dd>specify a location in <a href="#system_location">named coordinates</a> &ndash; <code>hex</code> is optional; <code>scale</code> will be ignored.
      <dt>sx
      <dt>sy
      <dt>hx
      <dt>hy <dd>specify a location in <a href="#system_sectorhex">Sector/Hex coordinates</a> (<code>scale</code> must also be explicitly specified)
      <dt>x
      <dt>y <dd>specify a location in <a href="#system_map">Map-space coordinates</a>
      <dt>galdir=0 <dd>Turn off the overlay of galactic directions (Spinward, Coreward, etc)

      <dt>q
      <dd>perform a search for the given query
        (<a target=_blank rel=noopener href="../?q=regina">example</a>)
      <dt>qn
      <dd>perform a search for the given query, and navigate to the first result
        (<a target=_blank rel=noopener href="../?qn=regina">example</a>)
    </dl>


    <h4>Markers:</h4>

    <dl class="params">
      <dt>marker_url=<var>URL</var>
        <dd>Marker image URL.

      <dt>marker_sector
      <dt>marker_hex
        <dd>Show a marker at <a href="#system_location">named coordinates</a>
          (<a target=_blank rel=noopener href="../?marker_sector=spin&amp;marker_hex=1910&amp;marker_url=res/markers/beowulf.png">example</a>)

      <dt>marker_sx
      <dt>marker_sy
      <dt>marker_hx
      <dt>marker_hy
        <dd>Show a marker at <a href="#system_sectorhex">Sector/Hex coordinates</a>
            (<a target=_blank rel=noopener href="../?marker_sx=-4&amp;marker_sy=-1&amp;marker_hx=19&amp;marker_hy=10&amp;marker_url=res/markers/beowulf.png">example</a>)

      <dt>marker_x
      <dt>marker_y
        <dd>Show a marker at <a href="#system_map">Map-space coordinates</a>
          (<a target=_blank rel=noopener href="../?marker_x=-95.914&amp;marker_y=70.5&amp;marker_url=res/markers/beowulf.png">example</a>)

      <dt>marker=<var>URL</var>
        <dd>Shortcut: The marker will be placed at the initial map location if the
          <code>sector</code> and <code>hex</code> options or a <code>/go/</code>
          link are used.
          (<a target=_blank rel=noopener href="../?sector=VLAN&amp;hex=1717&amp;marker=res/markers/submerchant.png">example</a>)
    </dl>


    <p>
      Marker images should be a 256px &times; 256px PNG and will be
      centered on the specified coordinates. A handful of example
      markers are available; relative URLs can be used for these.
      Images by Andrew Boulton, c/o FFE.
    </p>

    <table id="sample_markers">
      <tr>
        <td><img src="../res/markers/beowulf.png" style="width: 64px;" alt="Beowulf-Class Free Trader">
        <td><code>res/markers/beowulf.png</code>
      <tr>
        <td><img src="../res/markers/scout.png" style="width: 64px;" alt="Sulieman-Class Scout/Courier">
        <td><code>res/markers/scout.png</code>
      <tr>
        <td><img src="../res/markers/fartrader.png" style="width: 64px;" alt="Empress Marava-Class Far Trader">
        <td><code>res/markers/fartrader.png</code>
      <tr>
        <td><img src="../res/markers/submerchant.png" style="width: 64px;" alt="Akkigish-class Subsidized Merchant">
        <td><code>res/markers/submerchant.png</code>
      <tr>
        <td><img src="../res/markers/subliner.png" style="width: 64px;" alt="Subsidized Liner">
        <td><code>res/markers/subliner.png</code>
      <tr>
        <td><img src="../res/markers/merccruiser.png" style="width: 64px;" alt="Mercenary Cruiser">
        <td><code>res/markers/merccruiser.png</code>
      <tr>
        <td><img src="../res/markers/sdb.png" style="width: 64px;" alt="System Defense Boat">
        <td><code>res/markers/sdb.png</code>
      <tr>
        <td><img src="../res/markers/labship.png" style="width: 64px;" alt="Laboratory Ship">
        <td><code>res/markers/labship.png</code>
    </table>

    <h4>You Are Here:</h4>

    <p>A built-in marker type that is style-aware and shows "You Are Here".</p>

    <dl class="params">

      <dt>yah_sector
      <dt>yah_hex
        <dd>Show a marker at <a href="#system_location">named coordinates</a>
            (<a target=_blank rel=noopener href="../?yah_sector=spin&amp;yah_hex=1910">example</a>)

      <dt>yah_sx
      <dt>yah_sy
      <dt>yah_hx
      <dt>yah_hy
        <dd>Show a marker at <a href="#system_sectorhex">Sector/Hex coordinates</a>
            (<a target=_blank rel=noopener href="../?yah_sx=-4&amp;yah_sy=-1&amp;yah_hx=19&amp;yah_hy=10">example</a>)

      <dt>yah_x
      <dt>yah_y
        <dd>Show a marker at <a href="#system_map">Map-space coordinates</a>
            (<a target=_blank rel=noopener href="../?yah_x=-95.914&amp;yah_y=70.5">example</a>)

      <dt>yah
        <dd>Shortcut: The marker will be placed at the initial map location if the
          <code>sector</code> and <code>hex</code> options or a <code>/go/</code>
          link are used.
          (<a target=_blank rel=noopener href="../?sector=VLAN&amp;hex=1717&amp;yah">example</a>)
    </dl>

    <h4>Overlays:</h4>

    <dl class="params">
      <dt>ew=<var>date</var></dt>
      <dd><b>Empress Wave overlay:</b> the position of the Empress Wave
        at the given date is shown. The date can be specified as one of:
        <dl class="params">
          <dt><var>ddd-yyyy</var></dt><dd>Day and Year of the Imperial Calendar, e.g. <code>ew=132-1116</code></dd>
          <dt><var>yyyy.f...</var></dt><dd>Decimal date, e.g. <code>ew=1116.359</code></dd>
          <dt><var>yyyy</var></dt><dd>Year, e.g. <code>ew=1105</code></dd>
          <dt>milieu</dt><dd>Use the current milieu specified elsewhere, e.g. <code>ew=milieu</code>
        </dl>
        If a whole year or milieu is specified the actual width of the
        active effects of the phenomenon is shown when zoomed in far
        enough to see entire hexes. If a more specific date is
        specified, an approximation of the progress across parsecs is
        presented.
      </dd>

      <dt>ox
      <dt>oy
      <dt>ow
      <dt>oh
        <dd><a href="#system_map">Map-space coordinates</a> for the left, top, width, and height of an overlay or highlight rectangle to place over the map. To specify additional overlay rectangles, include
            <code>ox1</code>/<code>oy1</code>/<code>ow1</code>/<code>oh1</code>
            for the first additional overlay
            <code>ox2</code>/<code>oy2</code>/<code>ow2</code>/<code>oh2</code>
            for the second additional overlay, and so on. For example, here's the
            <a target=_blank rel=noopener href="../?ox=-111.95&amp;oy=80&amp;ow=194.2&amp;oh=200">Atlas of the Imperium coverage area</a>.

      <dt>ocx
      <dt>ocy
      <dt>ocr
        <dd><a href="#system_map">Map-space coordinates</a> for the center and radius overlay or highlight circle to place over the map.To specify additional overlay circles, include
            <code>ocx1</code>/<code>ocy1</code>/<code>ocr1</code>
            for the first additional overlay
            <code>ocx2</code>/<code>ocy2</code>/<code>ocr2</code>
            for the second additional overlay, and so on. For example, here's
            <a target=_blank rel=noopener href="../?ocx=-67.983&amp;ocy=55.5&amp;ocr=89">
              the region of space where the bright star Deneb is visible during daylight hours</a>.
    </dl>



  </section>

  <section id="go">
    <h3>Go Links &ndash; short URLs for specifying a location on the map</h3>
    <h4>API URLs:</h4>
    <p class="code">
        https://travellermap.com/go/<var>sector</var>
    </p>
    <p class="code">
        https://travellermap.com/go/<var>sector</var>/<var>hex</var>
    </p>
    <p>These URLs navigate the map page, and can be used instead of the longer
      <code>?sector=<var>sector</var>&amp;hex=<var>hex</var></code> syntax.
    </p>
    <h4>Example:</h4>
    <p>
        <a class="example" href="/go/spin/1910"></a>
    </p>
  </section>

  <section id="iframe">
    <h3>IFRAME &ndash; embed a map in your page</h3>
    <h4>Usage:</h4>
    <p class="code">
        &lt;iframe src="<var>URL</var>" style="<var>STYLE</var>"&gt;&lt;/iframe&gt;
    </p>
    <p>
        Where <var>URL</var> is any main page URL, including
        <a href="#query">query parameters</a> and/or <a href="#go">go links</a>.
    <p>
        And <var>STYLE</var> is something like:</p>
    <p class="code">
        width: 200px; height: 200px; border: solid 1px black;
    </p>

   <h4>Notes:</h4>
    <ul>
        <li>You use the same URL as for the main page. The site detects that it's running in an iframe and automatically hides the UI.
        <li>User preferences are ignored, so that you can control the styling and location with parameters.
        <li>You can drag with the mouse and zoom by using the mouse wheel or double-clicking (hold Alt and double-click to zoom out). You can even use the <kbd>IJKL</kbd> keys or arrow keys to scroll the map.
        <li>For sites such as Wikis that (for security reasons) do not allow embedding arbitrary IFRAMEs, see the <a href="#poster">Poster API</a> instead.
        <li>The <var>STYLE</var> of the IFRAME element can be anything you want to match your site &ndash; the width and height are just examples
        <li>By default, the UI is hidden. To force the UI to be shown in an iframe, add the URL parameter <code>forceui=1</code>
    </ul>

    <h4>Example:</h4>
    <pre class="code">
&lt;iframe
   src="https://travellermap.com/go/spin/1910?style=print"
   style="border: ridge 10px gray;"&gt;
&lt;/iframe&gt;
    </pre>

    <iframe src="https://travellermap.com/go/spin/1910?style=print"
            style="border: ridge 10px gray;">
    </iframe>

   <h4>Beta Features:</h4>
    <ul>
        <li>When the user clicks or double-clicks on the map, a
          <a target=_blank rel=noopener href="https://html.spec.whatwg.org/multipage/comms.html#the-messageevent-interfaces">message event</a>
          will posted to the containing page. The <code>data</code> element of the
          event will have the form:
          <pre class="code">
{source: "travellermap", type: "click", location: {x: 19: y: 10}}
          </pre>
          or:
          <pre class="code">
{source: "travellermap", type: "doubleclick", location: {x: 19: y: 10}}
          </pre>
    </ul>

  </section>
  </section>

  <section id="data-apis" class="apis">
    <h2>Data APIs</h2>

  <section id="coordinates">
    <h3>Coordinates &ndash; sector lookup and coordinate conversion</h3>
    <h4>API URLs:</h4>
    <p class="code">
        https://travellermap.com/api/coordinates?sector=<var>sector</var>
    </p>
    <p class="code">
        https://travellermap.com/api/coordinates?sector=<var>sector</var>&amp;hex=<var>hex</var>
    </p>
    <p class="code">
        https://travellermap.com/api/coordinates?sector=<var>sector</var>&amp;subsector=<var>subsector</var>
    </p>
    <p class="code">
        https://travellermap.com/api/coordinates?sx=<var>sx</var>&amp;sy=<var>sy</var>
    </p>
    <p class="code">
        https://travellermap.com/api/coordinates?sx=<var>sx</var>&amp;sy=<var>sy</var>&amp;hx=<var>hx</var>&amp;hy=<var>hy</var>
    </p>
    <h4>Data URLs:</h4>
    <p class="code">
        https://travellermap.com/data/<var>sector</var>/coordinates
    </p>
    <p class="code">
        https://travellermap.com/data/<var>sector</var>/<var>hex</var>/coordinates
    </p>

    <h4>Parameters:</h4>
    <dl class="params">
        <dt>sector <dd>specify the <a href="#system_location">sector location</a> by name, e.g. "Spinward%20Marches"
        <dt>hex <dd>specify <a href="#system_location">hex location</a>; optional
        <dt>subsector <dd>specify subsector (<code>A</code> &ndash; <code>P</code> or name); optional
        <dt>sx
        <dt>sy <dd>sector in <a href="#system_sectorhex">sector/hex coordinates</a>
        <dt>hx
        <dt>hy <dd>hex in <a href="#system_sectorhex">sector/hex coordinates</a>
        <dt>x
        <dt>y <dd>location in <a href="#system_world">world-space coordinates</a>
        <dt>milieu <dd>data milieu (e.g. <code>M1900</code>); optional
    </dl>

    <h4>Notes:</h4>
    <ul>
        <li>The following coordinates are returned:
            <ul>
                <li><a href="#system_sectorhex">Sector/Hex coordinates</a> sx, sy, hx, hy
                <li><a href="#system_world">World-Space Coordinates</a> x, y
            </ul>

        <li>If <code>sector</code> is specified without <code>hex</code> or <code>subsector</code>,
          the coordinates of the top-left corner of the sector are returned.
        <li>If <code>sector</code> and <code>subsector</code> are specified,
          the coordinates of the center of of the subsector are returned.
        <li>
          The default output format is <a href="http://json.org/">JSON</a>. To retrieve results in XML form, specify
          the HTTP header <code>Accept: text/xml</code> or include <code>accept=text/xml</code>
          in the query string.

    </ul>

    <h4>Example:</h4>
    <p>
        <a class="example" href="/api/coordinates?sector=Spinward%20Marches&amp;hex=1910"></a>
    </p>
  </section>

  <section id="credits">
    <h3>Credits &ndash; get world data for a given location</h3>
    <h4>API URLs:</h4>
    <p class="code">
        https://travellermap.com/api/credits?sector=<var>sector</var>
    </p>
    <p class="code">
        https://travellermap.com/api/credits?sector=<var>sector</var>&amp;hex=<var>hex</var>
    </p>
    <p class="code">
        https://travellermap.com/api/credits?sx=<var>sx</var>&amp;sy=<var>sy</var>
    </p>
    <p class="code">
        https://travellermap.com/api/credits?sx=<var>sx</var>&amp;sy=<var>sy</var>&amp;hx=<var>hx</var>&amp;hy=<var>hy</var>
    </p>
    <p class="code">
        https://travellermap.com/api/credits?x=<var>x</var>&amp;y=<var>y</var>
    </p>
    <h4>Data URLs:</h4>
    <p class="code">
        https://travellermap.com/data/<var>sector</var>/credits
    </p>
    <p class="code">
        https://travellermap.com/data/<var>sector</var>/<var>hex</var>/credits
    </p>

    <h4>Parameters:</h4>
    <dl class="params">
        <dt>sector <dd>specify the <a href="#system_location">sector location</a> by name, e.g. "Spinward%20Marches"
        <dt>hex <dd>specify <a href="#system_location">hex location</a> within the named sector (defaults to 1620 if unspecified)
        <dt>sx
        <dt>sy <dd>sector in <a href="#system_sectorhex">sector/hex coordinates</a>
        <dt>hx
        <dt>hy <dd>hex in <a href="#system_sectorhex">sector/hex coordinates</a>
        <dt>x
        <dt>y <dd>location in <a href="#system_world">world-space coordinates</a>
        <dt>milieu <dd>data milieu (e.g. <code>M1900</code>); optional
    </dl>

    <h4>Notes:</h4>
    <ul>
      <li>
        The default output format is <a href="http://json.org/">JSON</a>. To retrieve results in XML form, specify
        the HTTP header <code>Accept: text/xml</code> or include <code>accept=text/xml</code>
        in the query string.
    </ul>

    <h4>Example:</h4>
    <p>
        <a class="example" href="/api/credits?x=-110&amp;y=-70"></a>
    </p>
  </section>

  <section id="sec">
    <h3>SEC &ndash; retrieve UWP data for a sector</h3>
    <h4>HTTP Methods:</h4>
    <dl class="params">
      <dt>GET
        <dd>The sector to output is specified some combination of the following URL parameters:

          <h4>API URLs:</h4>
          <p class="code">https://travellermap.com/api/sec?sector=<var>sector</var></p>
          <p class="code">https://travellermap.com/api/sec?sector=<var>sector</var>&amp;hex=<var>hex</var></p>
          <p class="code">https://travellermap.com/api/sec?sector=<var>sector</var>&amp;subsector=<var>subsector</var></p>
          <p class="code">https://travellermap.com/api/sec?sector=<var>sector</var>&amp;quadrant=<var>quadrant</var></p>
          <p class="code">https://travellermap.com/api/sec?sx=<var>sx</var>&amp;sy=<var>sy</var></p>
          <h4>Data URLs:</h4>
          <p class="code">https://travellermap.com/data/<var>sector</var></p>
          <p class="code">https://travellermap.com/data/<var>sector</var>/sec</p>
          <p class="code">https://travellermap.com/data/<var>sector</var>/tab</p>

          <p class="code">https://travellermap.com/data/<var>sector</var>/<var>subsector</var></p>
          <p class="code">https://travellermap.com/data/<var>sector</var>/<var>subsector</var>/sec</p>
          <p class="code">https://travellermap.com/data/<var>sector</var>/<var>subsector</var>/tab</p>

          <p class="code">https://travellermap.com/data/<var>sector</var>/<var>quadrant</var></p>
          <p class="code">https://travellermap.com/data/<var>sector</var>/<var>quadrant</var>/sec</p>
          <p class="code">https://travellermap.com/data/<var>sector</var>/<var>quadrant</var>/tab</p>

          <h4>Parameters:</h4>
          <dl class="params">
            <dt>sector <dd>sector name or T5SS abbreviation
            <dt>subsector <dd><code>A</code> &ndash; <code>P</code> or name; optional &ndash; if specified, only UWPs for that subsector will be included
            <dt>quadrant <dd>one of <code>Alpha</code>, <code>Beta</code>, <code>Gamma</code> or <code>Delta</code>
            <dt>sx
            <dt>sy <dd>sector in <a href="#system_sectorhex">sector/hex coordinates</a>
            <dt>milieu <dd>data milieu (e.g. <code>M1900</code>); optional
          </dl>

        <dt>POST
        <dd>
          The body of the request is sector data to be parsed. After successful
          parsing, the same data is returned but reformatted according to the
          selected options. This can be used to convert
          <a href="fileformats#sec">SEC</a> data to
          <a href="fileformats#t5tab">T5 Tab Delimited</a> for easier parsing
          by script. The format of the input data is "sniffed" &ndash; if it contains
          tabs it is assumed to be in
          <a href="fileformats#t5tab">T5 Tab Delimited</a> format; if it
          contains extension field delimiters it is assumed to be in
          <a href="fileformats#t5col">T5 Column Delimited</a> format;
          otherwise, it is parsed as
          <a href="fileformats#sec">Legacy SEC</a> format.
          <h4>Parameters:</h4>
          <dl class="params">
            <dt>lint=1
            <dd>Return an HTTP failure (400) if warnings or errors are found while parsing the sector data.
            The default is to silently ignore any lines with errors.
          </dl>
    </dl>

    <h4>Options:</h4>
    <dl class="params">
        <dt>type=SecondSurvey
        <dd>
          <a href="fileformats#t5col">Data Format Definition</a>
          The <cite>Traveller<sup>5</sup> Second Survey</cite> format in human readable form:
          Hex, Name, UWP, Trade Classifications and Remarks,
          Extensions (Ix, Ex, Cx), Nobility (N), Bases (B), Travel Zone (Z), PBG, Worlds (W), Allegiance and Stellar.
          Note that fields may be blank if no official T5 data exists.
          <p class="aside">Second Survey is the default for <code>/data/</code> URLs.</p>

        <dt>type=TabDelimited
        <dd>
          <a href="fileformats#t5tab">Data Format Definition</a>
          Full <cite>Traveller<sup>5</sup> Second Survey</cite> data, in a more easily parsed format.

        <dt>type=Legacy
        <dd>
          <a href="fileformats#genie">Data Format Definition</a>
          Legacy sector format: Name, Hex, UWP, Bases, Trade Classifications and Remarks, Travel Zone, PBG, Allegiance and Stellar.
          <p class="aside">Legacy format is the default for <code>/api/</code> URLs</p>

        <dt>metadata=0 <dd>Don't include sector metadata as comments in the file
        <dt>header=0 <dd>Don't include field definitions in the file
        <dt>sscoords=1 <dd>Use subsector style (0101-0810) numbering instead of sector style (0101-3240)
    </dl>

    <h4>Notes:</h4>
    <ul>
        <li>The column widths in <code>SecondSurvey</code> format are computed dynamically. The header and separator lines must be parsed to identify columns.
        <li>The column widths in the legacy format are defined in the header; data may be truncated to fit.
        <li>If you are programatically consuming the data, it is strongly recommended that you use <code>TabDelimited</code> format
        <li>If a <a href="#jsonp">jsonp</a> query parameter is specified, the results are wrapped in a JSONP callback
    </ul>

    <h4>Example:</h4>
    <p>
        <a class="example" href="/api/sec?sector=Spinward%20Marches&amp;type=SecondSurvey"></a>
    </p>
  </section>

  <section id="metadata">
    <h3>Metadata &ndash; retrieve metadata for a sector</h3>
    <h4>HTTP Methods:</h4>
    <dl class="params">
      <dt>GET
      <dd>
        The sector to output is specified some combination of the following URL parameters:
        <h4>API URLs:</h4>
        <p class="code">https://travellermap.com/api/metadata?sector=<var>sector</var></p>
        <p class="code">https://travellermap.com/api/metadata?sx=<var>sx</var>&amp;sy=<var>sy</var></p>
        <h4>Data URLs:</h4>
        <p class="code">https://travellermap.com/data/<var>sector</var>/metadata</p>

        <h4>Parameters:</h4>
        <dl class="params">
          <dt>sector <dd>sector name or T5SS abbreviation
              <dt>sx
              <dt>sy <dd>sector in <a href="#system_sectorhex">sector/hex coordinates</a>
              <dt>milieu <dd>data milieu (e.g. <code>M1900</code>); optional
        </dl>

      <dt>POST
      <dd>
        The body of the request is sector metadata to be parsed. After successful
        parsing, the same data is returned but reformatted according to the
        selected options. This can be used to convert
        XML or MSEC to JSON for easier parsing by script. The input data format is
        "sniffed" &ndash; if it has an XML prologue it is assumed to be
        <a href="metadata">XML</a> format
        (<a href="/data/spin/metadata">example</a>); otherwise,
        <a href="http://dotclue.org/t20/">MSEC</a> format
        (<a href="/data/spin/msec">example</a>) is assumed. JSON parsing
        is not supported.

        <h4>Parameters:</h4>
        <dl class="params">
          <dt>lint=1
          <dd>Return an HTTP failure (400) if warnings or errors are found while parsing the sector data.
          The default is to silently ignore any lines with errors.
        </dl>
    </dl>
    <h4>Notes:</h4>
    <ul>
        <li>
          The default output format is <a href="http://json.org/">JSON</a>. To retrieve results in XML form, specify
          the HTTP header <code>Accept: text/xml</code> or include <code>accept=text/xml</code>
          in the query string.

        <li>The XML data is the same format as consumed by the <a href="#poster">Poster</a> API
          when using HTTP <code>POST</code>, described in
          <a href="metadata">Sector Metadata File Format</a>.
    </ul>

    <h4>Example:</h4>
    <p>
        <a class="example" href="/api/metadata?sector=Spinward%20Marches"></a>
    </p>
  </section>

  <section id="msec">
    <h3>MSEC &ndash; generate sec2pdf metadata for a sector</h3>
    <h4>API URLs:</h4>
    <p class="code">https://travellermap.com/api/msec?sector=<var>sector</var></p>
    <p class="code">https://travellermap.com/api/msec?sx=<var>sx</var>&amp;sy=<var>sy</var></p>
    <h4>Data URLs:</h4>
    <p class="code">https://travellermap.com/data/<var>sector</var>/msec</p>

    <h4>Parameters:</h4>
    <dl class="params">
        <dt>sector <dd>sector name
        <dt>sx
        <dt>sy <dd>sector in <a href="#system_sectorhex">sector/hex coordinates</a>
        <dt>milieu <dd>data milieu (e.g. <code>M1900</code>); optional
    </dl>

    <h4>Notes:</h4>
    <ul>
        <li><a href="http://dotclue.org/t20/">sec2pdf at http://dotclue.org/t20/</a>
        <li>If a <a href="#jsonp">jsonp</a> query parameter is specified, the results are wrapped in a JSONP callback
    </ul>

    <h4>Example:</h4>
    <p>
        <a class="example" href="/api/msec?sector=Spinward%20Marches"></a>
    </p>
  </section>

  <section id="jumpworlds">
    <h3>Jump Worlds &ndash; return a list of worlds within N parsecs</h3>
    <h4>API URLs:</h4>
    <p class="code">
        https://travellermap.com/api/jumpworlds?x=<var>x</var>&amp;y=<var>y</var>
    </p>
    <p class="code">
        https://travellermap.com/api/jumpworlds?sx=<var>sx</var>&amp;sy=<var>sy</var>&amp;hx=<var>hx</var>&amp;hy=<var>hy</var>
    </p>
    <p class="code">
        https://travellermap.com/api/jumpworlds?sector=<var>sector</var>&amp;hex=hex
    </p>
    <h4>Data URLs:</h4>
    <p class="code">
      https://travellermap.com/data/<var>sector</var>/<var>hex</var>
    </p>
    <p class="code">
      https://travellermap.com/data/<var>sector</var>/<var>hex</var>/jump/<var>jump</var>
    </p>

    <h4>Parameters:</h4>
    <dl class="params">
        <dt>jump <dd>jump distance to include (<code>0</code> through <code>12</code>, default is <code>6</code>)
        <dt>sector <dd>specify the <a href="#system_location">sector location</a> by name, e.g. "Spinward%20Marches"
        <dt>hex <dd>specify <a href="#system_location">hex location</a> within the named sector
        <dt>sx
        <dt>sy <dd>sector in <a href="#system_sectorhex">sector/hex coordinates</a>
        <dt>hx
        <dt>hy <dd>hex in <a href="#system_sectorhex">sector/hex coordinates</a>
        <dt>x
        <dt>y <dd>location in <a href="#system_world">world-space coordinates</a>
        <dt>milieu <dd>data milieu (e.g. <code>M1900</code>); optional
    </dl>

    <h4>Notes:</h4>
    <ul>
      <li>The short Data URL form (<code>/data/<var>sector</var>/<var>hex</var></code>) is an alias for jump 0 &mdash; only details for the specified
        system are returned.
      <li>Returns a list of worlds. Each world has the following fields (in no particular order), although fields may be omitted if blank:
        <ul>
          <li><code>Name</code>
          <li><code>Hex</code>
          <li><code>UWP</code>
          <li><code>Bases</code>
          <li><code>Remarks</code>
          <li><code>Zone</code>
          <li><code>PBG</code>
          <li><code>Allegiance</code>
          <li><code>Stellar</code>
          <li><code>Ix</code>
          <li><code>Ex</code>
          <li><code>Cx</code>
          <li><code>Nobility</code>
          <li><code>Worlds</code>
        </ul>

      <li>
        The default output format is <a href="http://json.org/">JSON</a>. To retrieve results in XML form, specify
        the HTTP header <code>Accept: text/xml</code> or include <code>accept=text/xml</code>
        in the query string.
    </ul>

    <h4>Example:</h4>
    <p>
        <a href="https://travellermap.com/api/jumpworlds?sector=Spinward%20Marches&amp;hex=1910&amp;jump=4">Worlds within Jump-4 of Regina</a>
    </p>
  </section>

  <section id="search">
    <h3>Search &ndash; find worlds or regions by name or attributes</h3>
    <h4>API URLs:</h4>
    <p class="code">
        https://travellermap.com/api/search?q=<var>QUERY</var>
    </p>

    <h4>Parameters:</h4>
    <dl class="params">
        <dt>q <dd>query string
        <dt>milieu <dd>data milieu (e.g. <code>M1900</code>); optional
    </dl>

    <h4>Notes:</h4>
    <ul>
        <li>Perform a search of names for matching sectors, subsectors, worlds
          and labeled regions.
        <li>All searches are <em>case-insensitive</em>.
        <li>By default, only matches at the start of names or after spaces are returned. So "<code>sol</code>" will match "Sol", "Solomani Rim" and "Nowa Sol" but not "Marsol"
        <li>Wildcards:
          <code>*</code> and <code>%</code> can be used as a "zero or more of any character";
          <code>?</code> and <code>_</code> can be used as "exactly one character".
          <code>[]</code> can be used for character ranges, e.g. <code>[0-5]</code> or <code>[m-z]</code> or <code>[89ABC]</code>.
          For example, "<code>r*a</code>" will match Regina.
        <li>Specifying a wildcard within a word turns <em>off</em> the "start of word" match. So "<code>re*in</code>" will <em>not</em> match "Regina" (but "<code>re*in*</code>" will).
        <li>Add <code>exact:</code> as a prefix to force an exact match, e.g. "<code>exact:sol</code>" will not match "Solomani Rim"
        <li>Add <code>like:</code> as a prefix to do a "sounds like" match, e.g. "<code>like:tear</code>" will find "Terra"
        <li>Specify more than one (space-delimited) word in the query to refine the search. Words are joined as logical <em>and</em> clauses. So "<code>so ri</code>" will match "Solomani Rim"
          (This combines strangely with wildcards; "<code>sol* ri*</code>" tries to find something matching both "<code>sol*</code>" <em>and</em> "<code>ri*</code>" so nothing will be found!)
        <li>Add <code>uwp:</code> as a prefix to a word to search the relevant fields. Examples:
            <dl class="params">
                <dt>uwp:a* <dd>find worlds with class A starports
                <dt>t* uwp:*f <dd>find worlds with names beginning with T that are tech level F
            </dl>
        <li>Similarly, you can use <code>pbg:</code>, <code>zone:</code>, <code>alleg:</code>
          to match on PBG, Zone or Allegiance respectively.
        <li>Use <code>remark:</code> to require a specific remark, e.g. <code>remark:Hi</code>
          to limit the results to high-population worlds.
        <li>Add <code>in:</code> as a prefix to a word to search the sector name. Examples:
            <dl class="params">
                <dt>t* in:spin <dd>find worlds in Spinward Marches sector begining with T
                <dt>uwp:*-f in:"Solomani Rim"<dd>find worlds with tech level F in the Solomani Rim
            </dl>

        <li>Specifying a search query of XXXXXXX-X (seven alphanumeric characters, hyphen, one alphanumeric character) is a shortcut for <code>uwp:</code>
        <li>Searches are performed on individual items (sectors, subsectors, worlds). You cannot at present do scoped search such as "TL-F worlds in the Solomani Rim"
        <li>Results may appear for items with multiple names (e.g. Solomani Rim sector is known as <em>Kushuggi</em> in Vilani); this is a correct result, although the alternate name is not apparent on the site.
        <li>
          The default output format is <a href="http://json.org/">JSON</a>. To retrieve results in XML form, specify
          the HTTP header <code>Accept: text/xml</code> or include <code>accept=text/xml</code>
          in the query string.
    </ul>

    <h4>Example:</h4>
    <p>
        <a class="example" href="/api/search?q=Regina"></a>
    </p>
  </section>

  <section id="route">
    <h3>Route &ndash; find jump routes between worlds</h3>
    <h4>API URLs:</h4>
    <p class="code">
        https://travellermap.com/api/route?start=<var>LOC</var>&amp;end=<var>LOC</var>&amp;jump=<var>N</var>
    </p>

    <h4>Parameters:</h4>
    <dl class="params">
        <dt>start <dd>start location, e.g. <code>SPIN 1910</code>
        <dt>end <dd>end location, e.g. <code>SOLO 1827</code>
        <dt>jump <dd>jump distance (<code>0</code> through <code>12</code>, default is <code>2</code>)
    </dl>

    <h4>Options:</h4>
    <dl class="params">
        <dt>x
        <dt>y <dd>search position in <a href="#system_world">world-space coordinates</a>

        <dt>milieu
        <dd>data milieu (e.g. <code>M1900</code>); optional

        <dt>wild=1
        <dd>stops must have wilderness refueling (gas giant or liquid water present)

        <dt>im=1
        <dd>stops must be member worlds of the Third Imperium

        <dt>nored=1
        <dd>stops must not be restricted (TAS Red Zones)

        <dt>aok=1
        <dd>stops at anomalies/calibration points allowed
    </dl>

    <h4>Notes:</h4>
    <ul>
        <li>Returns the shortest path found between the start and end worlds,
          with the given jump range, if any.

        <li>If the start/end location matches is given as <var>SECTOR HEX</var>,
          e.g. <code>SPIN 1910</code> or <code>Solomani Rim 1827</code>
          a world at that position will be used.
        <li>Otherwise, the nearest matching world with that name will be used, if any.
          The <code>x</code>, <code>y</code> coordinates are used to determine "nearest"
          in case of multiple matches.
        <li>If the source or end location do not exist, or there is no route found given
          the contraints, the request will fail with status <code>404 Not Found</code>
          and a diagnostic message in the body.
        <li>Route restrictions (<code>wild</code>, <code>im</code>, <code>nored</code>)
          only apply to intermediate stops, not the start/end worlds.
        <li>
          The default output format is <a href="http://json.org/">JSON</a>. To retrieve results in XML form, specify
          the HTTP header <code>Accept: text/xml</code> or include <code>accept=text/xml</code>
          in the query string.
    </ul>

    <h4>Example:</h4>
    <p>
        <a class="example" href="/api/route?start=spin+1910&amp;end=spin+2110&amp;jump=1"></a>
    </p>
  </section>

  <section id="universe">
    <h3>Universe &ndash; return a list of all sectors</h3>
    <h4>API URLs:</h4>
    <p class="code">
        https://travellermap.com/api/universe
    </p>
    <h4>Data URLs:</h4>
    <p class="code">
        https://travellermap.com/data
    </p>

    <h4>Options:</h4>
    <dl class="params">
        <dt>era
        <dt>milieu <dd>data milieu (e.g. <code>M1900</code>); optional
        <dt>requireData <dd>If <code>1</code>, only sectors with data files will be included
        <dt>tag <dd>Required tags, e.g. <code>Official</code> or <code>InReview</code>.
          Multiple required tags can be specified using <code>|</code> as a separator, e.g.
          <code>tag=Official|InReview|Preserve</code>.
    </dl>

    <h4>Notes:</h4>
    <ul>
        <li>Returns a list of sectors providing X,Y coordinates and names.
        <li>The <code>era</code> parameter filters on an exact match only; the tagging of sectors with a precise year is sparse
        <li>The <code>tag</code> matching is case-sensitive.
        <li>
          The default output format is <a href="http://json.org/">JSON</a>. To retrieve results in XML form, specify
          the HTTP header <code>Accept: text/xml</code> or include <code>accept=text/xml</code>
          in the query string.

    </ul>

    <h4>Example:</h4>
    <p>
        <a class="example" href="/api/universe?era=1000"></a>
    </p>
  </section>

  <section id="t5ss">
    <h3>T5SS &ndash; return stock data</h3>
    <h4>Data URLs:</h4>
    <p class="code">
        https://travellermap.com/t5ss/allegiances
    </p>
    <p class="code">
        https://travellermap.com/t5ss/sophonts
    </p>

    <h4>Notes:</h4>
    <ul>
        <li><code>/t5ss/allegiances</code> returns a list of items with
          <code>Code</code> and <code>Name</code> pairs defining the
          T5SS allegiance codes.
        <li><code>/t5ss/sophonts</code> returns a list of items with
          <code>Code</code> and <code>Name</code> pairs defining the
          T5SS sophont codes.
        <li>
          The default output format is <a href="http://json.org/">JSON</a>. To retrieve results in XML form, specify
          the HTTP header <code>Accept: text/xml</code> or include <code>accept=text/xml</code>
          in the query string.
    </ul>

    <h4>Example:</h4>
    <p>
        <a class="example" href="/t5ss/sophonts"></a>
    </p>
  </section>
  </section>

  <section id="rendering-apis" class="apis">
    <h2>Rendering APIs</h2>
  <section id="tile">
    <h3>Tile &ndash; render an arbitrary rectangle of space</h3>
    <h4>API URLs:</h4>
    <p class="code">
        https://travellermap.com/api/tile?x=<var>x</var>&amp;y=<var>y</var>&amp;scale=<var>N</var>
    </p>

    <h4>Parameters:</h4>
    <dl class="params">
        <dt>x
        <dt>y <dd><a href="#system_tile">tile-space coordinate</a>
        <dt>scale <dd>scale in pixels/parsec
        <dt>milieu <dd>data milieu (e.g. <code>M1900</code>); optional
    </dl>
    <h4>Options:</h4>
    <dl class="params">
        <dt>options <dd><a href="#options">rendering options</a>
        <dt>style <dd><a href="#options">rendering style</a>
        <dt>w <dd>width of image to generate (pixels, default 256)
        <dt>h <dd>height of image to generate (pixels, default 256)
        <dt>accept <dd>specify <code>application/pdf</code> for PDF output or <code>image/svg+xml</code> for SVG; otherwise output depends on options
    </dl>

    <h4>Notes:</h4>
    <ul>
        <li>Generate a PNG or JPEG image of the specified region.
        <li>Coordinates are in tile-space coordinates (optimized for tile rendering, not navigation); conversion functions are in the script
        <li>Bitmap image format depends on selected options ("Candy" produces JPEG, otherwise PNG)
        <li>The HTTP <code>Accept</code> header can be used to specify <code>application/pdf</code> or <code>image/svg+xml</code>instead of the query parameter.
    </ul>

    <h4>Example:</h4>
    <p>
        <a class="example" href="/api/tile?x=-24.5&amp;y=-18&amp;scale=64&amp;options=887&amp;style=poster"></a>
    </p>
  </section>

  <section id="poster">
<h3>Poster &ndash; render a sector, quadrant or subsector</h3>
<h4>API URLs:</h4>
<p class="code">
    https://travellermap.com/api/poster
</p>
<p class="code">
    https://travellermap.com/api/poster?sector=<var>sector</var>
</p>
<p class="code">
  https://travellermap.com/api/poster?sector=<var>sector</var>&amp;subsector=<var>subsector</var>
</p>
<p class="code">
  https://travellermap.com/api/poster?sector=<var>sector</var>&amp;quadrant=<var>quadrant</var>
</p>
<h4>Data URLs:</h4>
<p class="code">
    https://travellermap.com/data/<var>sector</var>/image
</p>
<p class="code">
    https://travellermap.com/data/<var>sector</var>/<var>subsector</var>/image
</p>
<p class="code">
    https://travellermap.com/data/<var>sector</var>/<var>quadrant</var>/image
</p>

<h4>HTTP Methods:</h4>
<dl class="params">
  <dt>GET
    <dd>The content to render is specified some combination of the following URL parameters:
      <h4>Parameters:</h4>
      <dl class="params">
        <dt>sector <dd>sector name
        <dt>quadrant <dd>one of <code>Alpha</code>, <code>Beta</code>, <code>Gamma</code> or <code>Delta</code>
        <dt>subsector <dd>subsector (<code>A</code> &ndash; <code>P</code> or name)
        <dt>domain <dd>one of the <a target=_blank rel=noopener href="http://wiki.travellerrpg.com/Domain">domains of the Third Imperium</a> (Sylea, Vland, Gateway, Ilelish, Antares, Sol, Deneb)
        <dt>x1
        <dt>y1 <dd>top-left hex (inclusive) of the rectangle in <a href="#system_world">World-Space Coordinates</a>
        <dt>x2
        <dt>y2 <dd>bottom-right hex (inclusive) of the rectangle in <a href="#system_world">World-Space Coordinates</a>
        <dt>milieu <dd>data milieu (e.g. <code>M1900</code>); optional
      </dl>

  <dt>POST
    <dd>
      The content to render is submitted as part of the payload, allowing custom maps to be
      rendered. Options (see below) can be specified either as URL parameters or
      in the POST body. A specific subsector can be rendered using this parameter,
      which can be either part of the POST data or a URL parameter:

      <h4>Parameters:</h4>
      <dl class="params">
        <dt>subsector <dd>subsector index (<code>A</code> &ndash; <code>P</code>)
        <dt>lint=1
        <dd>Return an HTTP failure (400) if warnings or errors are found while parsing the sector data.
        The default is to silently ignore any lines with errors.
      </dl>

      Sector data and metadata can be sent in a variety of
      different ways, determined by the <code>Content-Type</code> header:
        <dl class="params">
          <dt>application/x-www-form-urlencoded
          <dd>This is a standard HTML form formatted body. In the POST body,
            a field named <code>data</code> must contain the sector data
            and a field named <code>metadata</code> may contain the metadata.
          <dt>multipart/form-data
          <dd>This allows file attachments to be used, as produced by using
            an HTML form with <code>input type="file"</code> elements.
            An attachment named <code>file</code> must contain the sector data,
            and an attachment named <code>metadata</code> may contain the metadata.
          <dt>text/plain
          <dd>The body of the request is the sector data. No metadata can be
            specified using this type. Other options must be specified in the URL.
        </dl>
        Sector data must be specified in
          <a href="fileformats#sec">SEC</a> (<a href="/data/spin/sec">example</a>),
          <a href="fileformats#t5tab">T5 Tab Delimited</a> (<a href="/data/spin/tab">example</a>), or
          <a href="fileformats#t5col">T5 Column Delimited</a> (<a href="/data/spin">example</a>) format.
        Metadata must be specified in either
          <a href="metadata">XML</a> (<a href="/data/spin/metadata">example</a>) or
          <a href="http://dotclue.org/t20/">MSEC</a> (<a href="/data/spin/msec">example</a>) format.
</dl>

<h4>Options:</h4>
<dl class="params">
    <dt>scale <dd>scale in pixels/parsec (default is 64)
    <dt>rotation <dd>rotate the image, 1 for 90&deg; clockwise, 2 for 180&deg;, 3 for 90&deg; counterclockwise
    <dt>hrotation <dd>rotate rendering within the image (in degrees); useful values are 60 and -60
    <dt>clampar=1 <dd>clamp aspect ratio between 4:5 and 1.91:1 (for popular image sharing sites)
    <dt>options <dd><a href="#options">rendering options</a>
    <dt>style <dd><a href="#options">rendering style</a>
    <dt>accept <dd>specify <code>application/pdf</code> for PDF output or <code>image/svg+xml</code> for SVG
    <dt>thumb=1 <dd>render a thumbnail (16 pixels/parsec)
</dl>

<h4>Notes:</h4>
<ul>
    <li>Generate a PNG or JPEG image of the specified sector (or just subsector), or an arbitrary rectangle of space.
    <li>Image format depends on selected options ("Candy" produces JPEG, otherwise PNG)
    <li>The HTTP <code>Accept</code> header can be used to specify <code>application/pdf</code> or <code>image/svg+xml</code> instead of the query parameter.
    <li>The <a href="../poster">Poster Maker</a> provides a friendly user interface to this API.
</ul>

<h4>Example:</h4>
<p class="code">
    &lt;img src="https://travellermap.com/api/poster?sector=spin&amp;subsector=C&amp;style=atlas&amp;scale=48"&gt;
</p>
<img src="/api/poster?sector=spin&amp;subsector=C&amp;style=atlas&amp;scale=48" style="border: solid 4px black;" alt="Regina Subsector">
</section>

  <section id="jumpmap">
    <h3>Jump Map &ndash; render hexes within N parsecs</h3>
    <h4>API URLs:</h4>
    <p class="code">
        https://travellermap.com/api/jumpmap?sector=<var>sector</var>&amp;hex=<var>hex</var>&amp;jump=<var>jump</var>
    </p>
    <p class="code">
        https://travellermap.com/api/jumpmap?sx=<var>sx</var>&amp;sy=<var>sy</var>&amp;hx=<var>hx</var>&amp;hy=<var>hy</var>&amp;jump=<var>jump</var>
    </p>
    <p class="code">
        https://travellermap.com/api/jumpmap?x=<var>x</var>&amp;y=<var>y</var>&amp;jump=<var>jump</var>
    </p>
    <h4>Data URLs:</h4>
    <p class="code">
      https://travellermap.com/data/<var>sector</var>/<var>hex</var>/jump/<var>jump</var>/image
    </p>



<h4>HTTP Methods:</h4>
<dl class="params">
  <dt>GET
    <dd>The map to render is specified some combination of the following URL parameters:
      <h4>Parameters:</h4>
      <dl class="params">
        <dt>jump <dd>jump distance to render (<code>0</code> through <code>20</code>, default is <code>6</code>)
        <dt>sector <dd>specify the <a href="#system_location">sector location</a> by name, e.g. "Spinward%20Marches"
        <dt>hex <dd>specify <a href="#system_location">hex location</a> within the named sector
        <dt>sx
        <dt>sy <dd>sector in <a href="#system_sectorhex">sector/hex coordinates</a>
        <dt>hx
        <dt>hy <dd>hex in <a href="#system_sectorhex">sector/hex coordinates</a>
        <dt>x
        <dt>y <dd>location in <a href="#system_world">world-space coordinates</a>
        <dt>hrotation<dd>rotate rendering within the image (in degrees); useful values are 60 and -60
        <dt>milieu <dd>data milieu (e.g. <code>M1900</code>); optional
      </dl>

  <dt>POST
    <dd>
      The content to render is submitted as part of the payload, allowing custom maps to be
      rendered. Options (see below) can be specified either as URL parameters or
      in the POST body. The specific hex to render is specified using these paramters,
      which can be either part of the POST data or URL parameters:

      <h4>Parameters:</h4>
      <dl class="params">
        <dt>jump <dd>jump distance to render (1 through 12, default is 6)
        <dt>hex <dd>specify <a href="#system_location">hex location</a> within the posted sector
        <dt>lint=1
        <dd>Return an HTTP failure (400) if warnings or errors are found while parsing the sector data.
        The default is to silently ignore any lines with errors.
      </dl>

      Sector data and metadata can be sent in a variety of
      different ways, determined by the <code>Content-Type</code> header:
        <dl class="params">
          <dt>application/x-www-form-urlencoded
          <dd>This is a standard HTML form formatted body. In the POST body,
            a field named <code>data</code> must contain the sector data
            and a field named <code>metadata</code> may contain the metadata.
          <dt>multipart/form-data
          <dd>This allows file attachments to be used, as produced by using
            an HTML form with <code>input type="file"</code> elements.
            An attachment named <code>file</code> must contain the sector data,
            and an attachment named <code>metadata</code> may contain the metadata.
          <dt>text/plain
          <dd>The body of the request is the sector data. No metadata can be
            specified using this type. Other options must be specified in the URL.
        </dl>
        Sector data must be specified in
          <a href="fileformats#sec">SEC</a> (<a href="/data/spin/sec">example</a>),
          <a href="fileformats#t5tab">T5 Tab Delimited</a> (<a href="/data/spin/tab">example</a>), or
          <a href="fileformats#t5col">T5 Column Delimited</a> (<a href="/data/spin">example</a>) format.
        Metadata must be specified in either
          <a href="metadata">XML</a> (<a href="/data/spin/metadata">example</a>) or
          <a href="http://dotclue.org/t20/">MSEC</a> (<a href="/data/spin/msec">example</a>) format.
</dl>

    <h4>Options:</h4>
    <dl class="params">
        <dt>scale <dd>scale in pixels/parsec (default is 64)
        <dt>options <dd><a href="#options">rendering options</a>
        <dt>style <dd><a href="#options">rendering style</a>
        <dt>border=0 <dd>don't render a thick border around the jumpmap
        <dt>accept <dd>specify <code>application/pdf</code> for PDF output or <code>image/svg+xml</code> for SVG
    </dl>

    <h4>Notes:</h4>
    <ul>
        <li>Generate a PNG image of the specified region.
        <li>PNG images (indexed, 8-bits per pixel) are returned unless PDF is requested; areas outside the hex borders will be transparent.
        <li>The HTTP <code>Accept</code> header can be used to specify <code>application/pdf</code> or <code>image/svg+xml</code> instead of the query parameter.
        <li>The <a href="../poster">Poster Maker</a> provides a friendly user interface to this API.
    </ul>

    <h4>Example:</h4>
    <p class="code">
        &lt;img src="https://travellermap.com/api/jumpmap?sector=spin&amp;hex=1910&amp;jump=4&amp;scale=48&amp;style=atlas"&gt;
    </p>
    <img src="/api/jumpmap?sector=spin&amp;hex=1910&amp;jump=4&amp;scale=48&amp;style=atlas" alt="Regina Jump-4 Map">
  </section>

  </section>

  <section id="appendix">
    <h2>Appendix</h2>
  <section id="systems">
    <h3>Coordinate Systems &ndash; the varied esoteric x/y values</h3>
    <p>
        Different APIs use different coordinate systems. Future API updates may attempt to unify them,
        but the different coordinate systems will always be required, as different APIs provide
        different views on the site dataset.
    </p>

  <section id="system_location">
    <h4>Named Location</h4>
    <p>
        Some APIs support simple named locations, namely the name of a sector followed by a four-digit hex
        number (in <em>xxyy</em> form). This is inefficient, as the sector must be looked up by name,
        but is supported for convenience in APIs likely to be specified as URLs directly by humans
        rather than automatically generated.
    </p>
    <p>
        The Traveller Map database of sector names accepts multiple spellings and languages for sector
        names ("Far Frontiers"/"Afachtiabr", "Dagudashaag"/"Dagudashag", etc) and is case-insensitive.
        Remember to URL-encode non-alphanumeric characters (e.g. spaces are <code>%20</code>).
    </p>
    <p>
      Sectors mapped as part of the <cite>Traveller<sup>5</sup> Second Survey</cite> (T5SS) process can be referenced by
      abbreviation as well, where the abbreviation is the first 4 letters (e.g. "spin" for the Spinward Marches), or
      3 in the case of Ley Sector ("ley");
    </p>
    <p>
        The <a href="#coordinates">Coordinates API</a> will look up a sector/hex location and produce sector/hex
        coordinates suitible for further calculations. For convenience, the <a href="#jumpmap">Jump Map API</a>,
        <a href="#credits">Credits API</a>, <a href="#iframe">IFRAME API</a>, and <a href="#query">main page</a> all accept named locations using
        <code>sector</code> and <code>hex</code> parameters.
    </p>
    <p>
        Example: Regina is "Spinward Marches" "1910"
    </p>
    </section>

  <section id="system_sectorhex">
  <h4>Sector/Hex Coordinates</h4>
  <p>
      Sector/Hex are the simplest numeric coordinates. These must be specified as a quartet of (sx, sy, hx, hy).
      The Core sector is at (0, 0), with positive X being Trailing and positive Y being Rimward.
      Hex coordinates are 1...32 and 1...40. Note that hx and hy must be specified separately.
    </p>
  <p class="aside">
    <em>Developers should
      be aware that many languages (C/C++, JavaScript, etc) will parse numbers with leading 0's as octal, so
      <code>08</code> and <code>09</code> give unexpected results.
      Use an appropriate parsing function with an explicit radix.</em>
  </p>
  <p>
      The <a href="#coordinates">Coordinates API</a> will map a named <code>sector</code> / <code>hex</code> pair (such as "Spinward Marches", "1910")
      to the numeric quartet in this coordinate space.
      The <a href="#jumpmap">Jump Map API</a> and <a href="#credits">Credits API</a> accept these coordinates using
      <code>sx</code>, <code>sy</code>, <code>hx</code> and
      <code>hy</code> parameters. The <a href="#coordinates">Coordinates API</a> can also accept
      these coordinates using those parameters to map to World-Space coordinates.
  </p>
  <p>
      Example: Regina (Spinward Marches 1910) is (sx=-4, sy=-1, hx=19, hy=10)
  </p>
  </section>

  <section id="system_world">
  <h4>World-Space Coordinates</h4>
  <p>
      World-space coordinates are more compact than Sector/Hex coordinates, requiring just two numbers. The
      transformation is simple, and based around Reference (Core 0140). In this scheme, Reference is at (0, 0),
      positive X is Trailing and positive Y is Rimward. To convert Sector/Hex to world-space coordinates, simply
      compute the distance to Reference:
  </p>
  <pre class="code">
var SECTOR_WIDTH = 32;
var SECTOR_HEIGHT = 40;

// Core sector is (0, 0)
var REFERENCE_SECTOR_X = 0;
var REFERENCE_SECTOR_Y = 0;

// Reference is Core 0140
var REFERENCE_HEX_X = 1;
var REFERENCE_HEX_Y = 40;

function sectorHexToWorldXY(sx, sy, hx, hy) {
  var x = (sx - REFERENCE_SECTOR_X) * SECTOR_WIDTH
        + (hx - REFERENCE_HEX_X);
  var y = (sy - REFERENCE_SECTOR_Y) * SECTOR_HEIGHT
        + (hy - REFERENCE_HEX_Y);
  return {x: x, y: y};
}
  </pre>
  <p>
      This scheme is roughly comparable to the canonical <cite>Traveller</cite> ring/ray system, but
      is far more convenient given that the origin is within Charted Space. This coordinate system is used by the
      <a href="#credits">Credits API</a> and the <a href="#jumpmap">Jump Map API</a>, which require selection of a
      specific hex. The coordinates are specified as <code>x</code> and <code>y</code> parameters
  </p>
  <p>
      The <a href="#coordinates">Coordinates API</a> will map a named location (<code>sector</code>, <code>hex</code>)
      or sector/hex coordinates (<code>sx</code>, <code>sy</code>, <code>hx</code>,
      <code>hy</code>) to world-space coordinates.
  </p>
  <p>
      Example: Regina is (x=-110, y=-70)
  </p>

  <div class="aside">
    <div>Within Charted Space, to convert world-space coordinates to ring/ray:</div>
    <br>
    <div>ring = y + 10000</div>
    <div>ray = x if x &ge; 0, or x + 62833 otherwise</div>
    <br>
    Example: Regina is (-70 + 10000) ring/ray (-110 + 62833), or 9930 ring/ray 62723
  </div>

  </section>

  <section id="system_map">
  <h4>Map-Space Coordinates</h4>
  <p>
      While world-space coordinates make a lot of sense for describing hexes, the fractional positioning required
      for precisely positioning the map dictates an additional map-space coordinate system. The conversion from
      world-space to map-space coordinates requires two steps:
  </p>
  <ul>
      <li>
          Account for "odd" hexes being further coreward than "even" hexes &ndash; i.e. hex 1910 is further coreward than hex 2010.
          Also note that odd/even switch places between Sector/Hex and World-space since Reference is at 0140 and (0, 0) respectively.

      <li>
          Account for hexes being packed more tightly horizontally than vertically, at a ratio of cos(30&deg;):1, and the
          Y-axis is inverted.

        <p class="aside">This is the only coordinate system with an inverted Y-axis.
          I don't know what I was thinking. I must have been asleep at the keyboard.</p>

  </ul>
  <pre class="code">
function isEven(n) { return (n % 2) === 0; }
var PARSEC_SCALE_X = Math.cos(Math.PI / 6); <span class="comment">// cosine 30&deg;</span>
var PARSEC_SCALE_Y = 1;

function worldXYToMapXY(world_x, world_y) {
  var ix = world_x - 0.5
  var iy = isEven(world_x) ? world_y - 0.5 : world_y
  var x = ix * PARSEC_SCALE_X;
  var y = iy * -PARSEC_SCALE_Y;
  return {x: x, y: y};
}
  </pre>
  <p>
      This coordinate system is used by the <a href="#query">main page</a> and the <a href="#iframe">IFRAME API</a> when a precise view
      point is required.
      The coordinates are specified as <code>x</code> and <code>y</code> parameters.
  </p>
  <p>
      Example: Regina is (x=-95.914, y=70.5)
  </p>
  </section>

  <section id="system_tile">
  <h4>Tile-Space Coordinates</h4>
  <p>
      Coordinates used by <a href="#tile">Tile API</a> are designed so that the basic operations
      of dragging the map around and requesting new tiles are as simple as possible. If the tile
      scale, width and height remain constant, the tiles at (0, 0) and (0, 1) are adjacent, and
      the origin is the same as map-space coordinates. Positive X is Trailing, positive Y is Rimward.
  </p>
  <pre class="code">
x =  map_x * scale / width;
y = -map_y * scale / height;
  </pre>
  <p>
      Since this is effectively an image-space coordinate system, standard graphics tricks
      can be used. For example, to center a tile rendering on a map-space coordinate, use:
  </p>
  <pre class="code">
x = (  map_center_x * scale - ( width  / 2 ) ) / width;
y = ( -map_center_y * scale - ( height / 2 ) ) / height;
  </pre>
  <p>
      This coordinate system is only used by the <a href="#tile">Tile API</a>.
      The coordinates are specified as <code>x</code> and <code>y</code> parameters.
  </p>
  <p>
      Example: Regina would be centered in a 512x384, 48px/pc tile at
      (x=-9.4919375, y=-9.3125)
  </p>
  </section>
</section>

  <section id="jsonp">
  <h3>JSONP &ndash; Use data APIs in your Web pages</h3>
  <p class="aside">
    APIs on this site
    output <a href="http://www.w3.org/TR/cors/">CORS</a> headers so if
    you know your users will be accessing your site using reasonably
    <a target=_blank rel=noopener href="http://caniuse.com/#search=cors">up-to-date browsers</a>
    you can call the APIs directly via
    <a href="https://fetch.spec.whatwg.org">fetch</a> or
    <a href="https://xhr.spec.whatwg.org">XMLHttpRequest</a>
    rather than using JSONP trick described below.
  </p>
  <p>
      Web browsers enforce a <a href="http://en.wikipedia.org/wiki/Same_origin_policy">Same Origin Policy</a>
      on content, to stop a page on evilhacker.com from scripting access to your bank account with your stored
      credentials. This is a good thing! Unfortunately, it also means that sites that want to cooperate have
      to jump through some hurdles. For example, you can't have a web page on your site that calls directly
      into one of the APIs on this site (via XMLHttpRequest) from JavaScript. Either the the sites need to have
      server-to-server communication (which is troublesome to set up, impractical in some circumstances, and
      introduces its own security issues) or they can play some tricks.
      <a href="http://en.wikipedia.org/wiki/JSONP#JSONP">JSONP</a> is one of those tricks.
  </p>
  <p>
      Web browsers allow pages to dynamically add content via script. They can even add references to additional
      script files, and those files can come from different sites. While a script cannot make AJAX calls
      to another site to retrieve data, it can cause a script from that site to be loaded just like a local
      script. The loaded script doesn't have any special abilities &ndash; it's still running within the domain of the
      page. The trick is to request a script with dynamically generated content &ndash; the data you wanted to request
      from the remote site in the first place!
  </p>

  <p>
      The following APIs on this site support JSONP requests:
  </p>

  <ul>
      <li><a href="#coordinates">Coordinates</a>
      <li><a href="#credits">Credits</a>
      <li><a href="#jumpworlds">Jump Worlds</a>
      <li><a href="#search">Search</a>
      <li><a href="#universe">Universe</a>
      <li><a href="#metadata">Metadata</a>
      <li><a href="#sec">SEC</a> (callback parameter is a single string containing linebreaks)
      <li><a href="#msec">MSEC</a> (callback parameter is a single string containing linebreaks)
  </ul>

  <p>
      To get a JSONP response, append <code>&amp;jsonp=<var>callbackfn</var></code> to your query string,
      where <var>callbackfn</var> is the name of the function you'd like the script to call. This is
      a function that should be pre-existing in your page, that takes an argument. The argument is
      the JavaScript value (usually an object with properties, sub-objects, arrays, etc).
  </p>

  <p>For example, here's how you could implement a search function on your site:</p>

  <pre class="code">
<span class="comment">// Call this function with a search query and callback:</span>
function jsonp_example(q, cb) {
  var name = <span class="string">'_cbfun'</span>;
  var url = <span class="string">'https://travellermap.com/api/search?q='</span> +
            encodeURIComponent(q) + <span class="string">'&amp;jsonp='</span> + name;
  var script_tag = document.createElement(<span class="string">'script'</span>);
  script_tag.setAttribute(<span class="string">'src'</span>, url);
  window[name] = function(data) {
    window[name] = null;
    document.body.removeChild(script_tag);
    cb(data);
  };
  document.body.appendChild(script_tag);
}

<span class="comment">// Example:</span>
jsonp_example('Regina', function(data) {
    alert(<span class="string">'Result count: '</span> + data.Results.Count);
});
  </pre>

  <h4>Example:</h4>
  <p>
      <a href="#" onclick="jsonp_demo(); return false;">Make a JSONP call</a>
  </p>

  <script>
// Call this function with a search query and callback:
function jsonp_example(q, cb) {
  var name = '_cbfun';
  var url = 'https://travellermap.com/api/search?q=' +
            encodeURIComponent(q) + '&jsonp=' + name;
  var script_tag = document.createElement('script');
  script_tag.setAttribute('src', url);
  window[name] = function(data) {
    window[name] = null;
    document.body.removeChild(script_tag);
    cb(data);
  };
  document.body.appendChild(script_tag);
}

// Example:
function jsonp_demo() {
  jsonp_example('Regina', function(data) {
    alert('Result count: ' + data.Results.Count);
  });
}
  </script>
</section>

  </section>

</div>

<script>
  (function () {
    // Remove leading/trailing lines from <pre>
    Array.from(document.querySelectorAll('pre')).forEach(function (pre) {
      pre.innerHTML = pre.innerHTML.replace(/(^ +\r?\n)|(\r?\n +$)/g, '');
    });

    // Shortcut: <a class="example" href="foo"></a>
    Array.from(document.querySelectorAll('a.example')).forEach(function (a) {
      a.appendChild(document.createTextNode(a.href));
    });

    // Allow breaking after / ? and & in code
    Array.from(document.querySelectorAll('.code')).forEach(function (e) {
      function textNodes(e) {
        var t = [];
        for (var n = e.firstChild; n; n = n.nextSibling) {
          switch (n.nodeType) {
            case Node.TEXT_NODE:
              t.push(n); break;
            case Node.ELEMENT_NODE:
            case Node.DOCUMENT_NODE:
            case Node.DOCUMENT_FRAGMENT_NODE:
              t = t.concat(textNodes(n)); break;
          }
        }
        return t;
      }

      // Inserted ZWJs show up when copied, so insert <wbr>
      textNodes(e).forEach(function(t) {
        while (true) {
          var m = /[/?&]+/.exec(t.nodeValue);
          if (!m) break;
          t = t.splitText(m.index + m[0].length);
          t.parentNode.insertBefore(document.createElement('wbr'), t);
        }
      });
    });
  }());
</script>

<div class="editorial">
  <p>
    The <em class="product">Traveller</em> game in all forms is owned by Far
    Future Enterprises. Copyright <span class=copyright>&copy;</span> 1977
    &ndash; 2018 Far Future Enterprises.
    <a href="http://farfuture.net/FFEFairUsePolicy2008.pdf">Fair Use Policy</a>
</div>

<a class="forkme" href="https://github.com/inexorabletash/travellermap"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png" alt="Fork me on GitHub"></a>

<script src="toc.js"></script>
